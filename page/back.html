<!DOCTYPE html>

<html>

	<head>
		<title>Background Test</title>
		<meta charset="UTF-8" />
	</head>

	<body>
		
		<canvas id="canvas" style="position: absolute; left: 0; right: 0; top: 0; bottom: 0; width: 100%; height: 100%">
			

		</canvas>

		<script type="text/javascript"> 

			"use strict";

			let can, ctx;

			let renderRefresh = true;
			let renderX, renderY, renderS, renderData, points;
			/*let renderX = 0;
			let renderY = 0;
			let renderS = renderX * renderY;
			let renderData = new Uint8ClampedArray(renderS * 4);*/
			let renderPixel = {r: 0, g: 0, b: 0}

			function resize(e) {
				renderRefresh = true;
			}

			let timeold = 0;
			let clock = 0;
			function frame(time) {
				clock = (time - timeold);
				timeold = time;

				if (renderRefresh) {
					renderRefresh = false;

					ctx.canvas.width  = window.innerWidth ;
					ctx.canvas.height = window.innerHeight;
					can.width

					renderX = window.innerWidth ;
					renderY = window.innerHeight;
					renderS = renderX * renderY;
					renderData = new Uint8ClampedArray(renderS * 4);
					console.log(renderX, renderY);

					points = [];
					for (let _ = 0; _ < 10; ++_) {

						points[_] = {
							x: Math.floor(Math.random() * renderX),
							y: Math.floor(Math.random() * renderY),
							r: Math.floor(Math.random() * 255),
							g: Math.floor(Math.random() * 255),
							b: Math.floor(Math.random() * 255),
							xv: ((Math.random() - 0.5) * 0.1),
							yv: ((Math.random() - 0.5) * 0.1),
							d: 0,
						};

					}

				}

				for (let i = 0; i < points.length; ++i) {

					points[i].x += points[i].xv * clock;
					points[i].y += points[i].yv * clock;

				}

				let pos = 0;
				for (let y = 0; y < renderY; ++y) {
					for (let x = 0; x < renderX; ++x) {

						let mindis = renderX + renderY;
						let minid = 0;
						let dis = 0;

						for (let i = 0; i < points.length; ++i) {

							if (points[i].x > renderX) { points[i].x = 0;       }
							if (points[i].y > renderY) { points[i].y = 0;       }
							if (points[i].x < 0)       { points[i].x = renderX; }
							if (points[i].y < 0)       { points[i].y = renderY; }

							points[i].d = Math.abs(Math.sqrt(Math.abs(
								y - points[i].y
							) + Math.abs(
								x - points[i].x
							)));
							if (points[i].d < mindis) {;
								minid = i;
								mindis = points[i].d;
							}

						}

						minid = points[minid];
						renderPixel.r = minid.r;
						renderPixel.g = minid.g;
						renderPixel.b = minid.b;

						renderData[pos    ] = renderPixel.r;
						renderData[pos + 1] = renderPixel.g;
						renderData[pos + 2] = renderPixel.b;
						renderData[pos + 3] = 255;
						pos += 4;

					}
				}
				ctx.putImageData(new ImageData(renderData, renderX, renderY), 0, 0);

				window.requestAnimationFrame(frame);

			}

			window.onload = () => {

				can = document.getElementById("canvas");
				ctx = can.getContext("2d");

				window.addEventListener("resize", resize);
				window.requestAnimationFrame(frame);

			};

		</script>


	</body>

</html>